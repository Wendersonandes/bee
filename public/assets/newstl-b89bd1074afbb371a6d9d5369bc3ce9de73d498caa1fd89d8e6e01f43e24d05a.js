window.addEventListener("load",function(){"use strict";function e(e,t,o){var r=o.x*t.y*e.z,n=t.x*o.y*e.z,a=o.x*e.y*t.z,i=e.x*o.y*t.z,s=t.x*e.y*o.z,E=e.x*t.y*o.z;return(-r+n+a-i-s+E)/6}$("#post_volume").hide();var t=640,o=550,r=new THREE.WebGLRenderer;r.setSize(t,o);var n=document.getElementById("view_teste");n.appendChild(r.domElement);var a=new THREE.PerspectiveCamera(45,t/o,.1,2e4);a.position.set(0,0,150);var i=new THREE.OrbitControls(a,n),s=new THREE.Scene;s.add(new THREE.AmbientLight(6710886)),s.background=new THREE.Color(16777215);var E=new THREE.DirectionalLight(16777215);E.position.set(0,100,100),s.add(E);var c=new THREE.DirectionalLight(16777215);c.position.set(0,-100,-100),s.add(c);var d=new THREE.MeshPhongMaterial({color:12566463,ambient:12566463,specular:197379}),l=new THREE.Mesh(new THREE.Geometry,d);s.add(l);var v,m,y,z,g=new THREE.Mesh(new THREE.Geometry,d),p=function R(){requestAnimationFrame(R),g.rotation.y+=.002,i.update(),r.clear(),r.render(s,a)};p();var w=function(r){var E=new FileReader;E.addEventListener("load",function(r){var E=r.target.result,c=loadStl(E);s.remove(g),l=new THREE.Mesh(c,d),l.rotation.x=-90*Math.PI/180;var p=(new THREE.Box3).setFromObject(l);console.log(p.min,p.max,p.size(),l.rotation),l.position.y=-(p.max.y-p.size().y/2),l.position.x=-(p.max.x-p.size().x/2),l.position.z=-(p.max.z-p.size().z/2),g=new THREE.Object3D,g.position.set(0,0,0),g.rotation.set(0,0,0),g.add(l),console.log("pqplsl");for(var w=0,f=0;f<l.geometry.faces.length;f++){console.log("blablabla");var R=l.geometry.faces[f].a,T=l.geometry.faces[f].b,u=l.geometry.faces[f].c,x=new THREE.Vector3(l.geometry.vertices[R].x,l.geometry.vertices[R].y,l.geometry.vertices[R].z),H=new THREE.Vector3(l.geometry.vertices[T].x,l.geometry.vertices[T].y,l.geometry.vertices[T].z),h=new THREE.Vector3(l.geometry.vertices[u].x,l.geometry.vertices[u].y,l.geometry.vertices[u].z);w+=e(x,H,h)}var b=Math.abs(w),M=p.size().x*p.size().y*p.size().z;console.log(M,b),$("#post_volume").val(b),v=p.size().x>p.size().y||p.size().z>p.size().y?p.size().z>p.size().y?p.size().z:p.size().x:p.size().y,m=2*Math.atan(v/400),console.log(m),y=m*(180/Math.PI),a=new THREE.PerspectiveCamera(y,t/o,1,800),a.position.set(0,63.767,300),z=12*(Math.PI/180),a.rotation.set(-z,0,0),i=new THREE.OrbitControls(a,n),s.add(g)},!1),E.readAsArrayBuffer(r)},f=document.getElementById("post_attachment");f.addEventListener("change",function(e){var t=e.target.files[0];w(t)},!1),n.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),n.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files[0];w(t)},!1)},!1);