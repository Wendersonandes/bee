!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e,s,h;h=function(t,i){return function(){return t.apply(i,arguments)}},s={align:"center",container:t("body"),offset:2,autoResize:!1,itemWidth:0,flexibleWidth:0,resizeDelay:50,onLayoutChanged:undefined},e=function(){function e(i,e){this.handler=i,this.columns=this.containerWidth=this.resizeTimer=null,this.activeItemCount=0,this.direction="left",this.itemHeightsDirty=!0,t.extend(!0,this,s,e),this.update=h(this.update,this),this.onResize=h(this.onResize,this),this.onRefresh=h(this.onRefresh,this),this.getItemWidth=h(this.getItemWidth,this),this.layout=h(this.layout,this),this.layoutFull=h(this.layoutFull,this),this.layoutColumns=h(this.layoutColumns,this),this.filter=h(this.filter,this),this.clear=h(this.clear,this),this.getActiveItems=h(this.getActiveItems,this);for(var n,o=j=0,r={};o<i.length;o++)if($item=i.eq(o),"object"==typeof(n=$item.data("filterClass"))&&n.length>0)for(j=0;j<n.length;j++)filterClass=t.trim(n[j]).toLowerCase(),filterClass in r||(r[filterClass]=[]),r[filterClass].push($item[0]);this.filterClasses=r,this.autoResize&&t(window).bind("resize.wookmark",this.onResize),this.container.bind("refreshWookmark",this.onRefresh)}return e.prototype.update=function(i){this.itemHeightsDirty=!0,t.extend(!0,this,i)},e.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.itemHeightsDirty=0!=this.flexibleWidth,this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},e.prototype.onRefresh=function(){this.itemHeightsDirty=!0,this.layout()},e.prototype.filter=function(i,e){var s,h,n,o,r,a=[],l=t();if(i=i||[],e=e||"or",i.length){for(h=0;h<i.length;h++)(r=t.trim(i[h].toLowerCase()))in this.filterClasses&&a.push(this.filterClasses[r]);if(s=a.length,"or"==e||1==s)for(h=0;h<s;h++)l=l.add(a[h]);else if("and"==e){var u,f,m,d=a[0],c=!0;for(h=1;h<s;h++)a[h].length<d.length&&(d=a[h]);for(h=0;h<d.length;h++){for(f=d[h],c=!0,n=0;n<a.length&&c;n++)if(m=a[n],d!=m){for(o=0,u=!1;o<m.length&&!u;o++)u=m[o]==f;c&=u}c&&l.push(d[h])}}this.handler.not(l).addClass("inactive")}else l=this.handler;l.removeClass("inactive"),this.columns=null,this.layout()},e.prototype.getActiveItems=function(){return this.handler.not(".inactive")},e.prototype.getItemWidth=function(){var t=this.itemWidth,i=this.container.width(),e=this.handler.eq(0),s=this.flexibleWidth;if(this.itemWidth===undefined||0===this.itemWidth&&!this.flexibleWidth?t=e.outerWidth():"string"==typeof this.itemWidth&&this.itemWidth.indexOf("%")>=0&&(t=parseFloat(this.itemWidth)/100*i),s){"string"==typeof s&&s.indexOf("%")>=0&&(s=parseFloat(s)/100*i-e.outerWidth()+e.innerWidth());var h=~~(1+i/(s+this.offset)),n=(i-(h-1)*this.offset)/h;t=Math.max(t,~~n),this.handler.css("width",t)}return t},e.prototype.layout=function(){if(this.container.is(":visible")){var t,e=this.getItemWidth()+this.offset,s=this.container.width(),h=~~((s+this.offset)/e),n=maxHeight=i=0,o=this.getActiveItems(),r=o.length;if(this.itemHeightsDirty){for(;i<r;i++)t=o.eq(i),t.data("outerHeight",t.outerHeight());this.itemHeightsDirty=!1}h=Math.max(1,Math.min(h,r)),n="left"==this.align||"right"==this.align?~~(h/e+this.offset>>1):~~(s-(h*e-this.offset)+.5>>1),this.direction="right"==this.align?"right":"left",null!=this.columns&&this.columns.length==h&&this.activeItemCount==r?maxHeight=this.layoutColumns(e,n):maxHeight=this.layoutFull(e,h,n),this.activeItemCount=r,this.container.css("height",maxHeight),this.onLayoutChanged!==undefined&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged()}},e.prototype.layoutFull=function(t,i,e){var s,h=0,n=0,o=this.getActiveItems(),r=o.length,a=null,l=null,u={position:"absolute"},f=[],m="left"==this.align;for(this.columns=[];f.length<i;)f.push(0),this.columns.push([]);for(;h<r;h++){for($item=o.eq(h),a=f[0],l=0,n=0;n<i;n++)f[n]<a&&(a=f[n],l=n);s=0==l&&m?0:l*t+e,u[this.direction]=s,u.top=a,$item.css(u),f[l]+=$item.data("outerHeight")+this.offset,this.columns[l].push($item)}return Math.max.apply(Math,f)},e.prototype.layoutColumns=function(t,i){for(var e,s,h,n=[],o=0,r=0;o<this.columns.length;o++)for(n.push(0),e=this.columns[o],h=o*t+i,r=0;r<e.length;r++)$item=e[r],s={top:n[o]},s[this.direction]=h,$item.css(s),n[o]+=$item.data("outerHeight")+this.offset;return Math.max.apply(Math,n)},e.prototype.clear=function(){clearTimeout(this.resizeTimer),t(window).unbind("resize.wookmark",this.onResize),this.container.unbind("refreshWookmark",this.onRefresh)},e}(),t.fn.wookmark=function(t){return this.wookmarkInstance?this.wookmarkInstance.update(t||{}):this.wookmarkInstance=new e(this,t||{}),this.wookmarkInstance.layout(),this.show()}});